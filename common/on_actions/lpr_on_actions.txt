# ============================================================================
# ON ACTIONS - MONTHLY EVENT SYSTEM
# ============================================================================
# This file hooks into the monthly country pulse to trigger LPR events.
# 
# MONTHLY BUILDER EVENTS:
# - Builder events fire every month with 100% chance
# - This provides opportunities to accumulate LPR points every month
#
# THRESHOLD CHECKS:
# - Monthly check if any LPR variable has reached threshold for finisher events
# - Other events (binary, big finisher, threshold) check monthly with adjusted
#   probabilities
# ============================================================================

# Fires every month for each country
on_monthly_pulse_country = {
	on_actions = {
		delay = { days = { 1 30 } }
		# lpr_initialize_variables_effect  # Initialize LPR variables first
		lpr_on_monthly_pulse_country
		lpr_check_finisher_events_effect
	}
}

lpr_initialize_variables_effect = {
	# Initialize LPR variables if they don't exist
	# This ensures the LPR system is ready for all countries
	effect = {
		# Initialize IIU global variables if they don't exist
		# These track worldwide trends and are shared across all countries
		if = {
			limit = {
				NOT = { has_global_variable = actionables_lpr_independence }
			}
			set_global_variable = {
				name = actionables_lpr_independence
				value = 0
			}
		}
		if = {
			limit = {
				NOT = { has_global_variable = actionables_lpr_innovation }
			}
			set_global_variable = {
				name = actionables_lpr_innovation
				value = 0
			}
		}
		if = {
			limit = {
				NOT = { has_global_variable = actionables_lpr_uprising }
			}
			set_global_variable = {
				name = actionables_lpr_uprising
				value = 0
			}
		}

		# Initialize local LPR variables if they don't exist
		if = {
			limit = {
				NOT = { has_variable = actionables_lpr_liberty }
			}
			set_variable = {
				name = actionables_lpr_liberty
				value = 0
			}
		}

		if = {
			limit = {
				NOT = { has_variable = actionables_lpr_progress }
			}
			set_variable = {
				name = actionables_lpr_progress
				value = 0
			}
		}

		if = {
			limit = {
				NOT = { has_variable = actionables_lpr_revolution }
			}
			set_variable = {
				name = actionables_lpr_revolution
				value = 0
			}
		}

		# Initialize spent tracking variables
		if = {
			limit = {
				NOT = { has_variable = actionables_lpr_liberty_spent }
			}
			set_variable = {
				name = actionables_lpr_liberty_spent
				value = 0
			}
		}

		if = {
			limit = {
				NOT = { has_variable = actionables_lpr_progress_spent }
			}
			set_variable = {
				name = actionables_lpr_progress_spent
				value = 0
			}
		}

		if = {
			limit = {
				NOT = { has_variable = actionables_lpr_revolution_spent }
			}
			set_variable = {
				name = actionables_lpr_revolution_spent
				value = 0
			}
		}
	}
}

lpr_on_monthly_pulse_country = {
	# Combined random events system
	# Builder events (30%), binary events (20%), big finisher events (15%), spent threshold events (10%)
	random_events = {

		# Builder events - fires every month with 30% chance
		70 = 0  # 70% no event
		30 = lpr_events.1  # 30% chance of triggering builder event

		# Binary choice events - 20% chance when variables >= 5
		# Note: Multiple binary events can trigger in the same month if multiple
		# variables are >= 5, but with moderate probability for balanced gameplay.
		80 = 0  # 80% chance of no event
		8 = lpr_events.2  # 20% chance of Liberty binary event when conditions met
		8 = lpr_events.3  # 20% chance of Progress binary event when conditions met
		8 = lpr_events.4  # 20% chance of Revolution binary event when conditions met

		# Big Finisher Binary Events - 15% chance when variables >= 20
		# These provide major rewards for consuming accumulated points
		85 = 0  # 85% chance of no event
		15 = lpr_events.11  # 15% chance of Liberty big finisher when conditions met
		15 = lpr_events.12  # 15% chance of Progress big finisher when conditions met
		15 = lpr_events.13  # 15% chance of Revolution big finisher when conditions met

		# Spent Threshold Events - 10% chance when cumulative spent variables reach milestones
		# These events fire once per threshold (100) for each LPR path
		# Flags prevent events from firing multiple times
		90 = 0  # 90% chance of no event
		10 = lpr_events.21  # 10% chance of Liberty spent threshold when conditions met
		10 = lpr_events.24  # 10% chance of Progress spent threshold when conditions met
		10 = lpr_events.27  # 10% chance of Revolution spent threshold when conditions met
	}

}

# ============================================================================
# LAW ENACTMENT POLITICS EVENTS
# ============================================================================
# These events trigger during law enactment debates, offering players the
# chance to spend LPR points for political advantages during legislation.
# ============================================================================

# Trigger politics events during law enactment debates
on_law_checkpoint_debate = {
	on_actions = {
		lpr_on_law_checkpoint_debate
	}
}

lpr_on_law_checkpoint_debate = {
	random_events = {
		10 = 0  # 
		10 = lpr_events.30  # Liberty politics event
		10 = lpr_events.31  # Progress politics event
		10 = lpr_events.32  # Revolution politics event
	}
}

lpr_check_finisher_events_effect = {
	# Check for finisher events every month (triggers if conditions met)
	# This evaluates if any LPR variable (Liberty, Progress, or Revolution)
	# has reached the threshold of 12 points, triggering a finisher event
	effect = {
		lpr_check_finisher_events = yes
	}
}